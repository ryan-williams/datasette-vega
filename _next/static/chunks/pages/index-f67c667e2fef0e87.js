(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(6854)}])},6854:function(e,t,n){"use strict";n.r(t),n.d(t,{AxisTypeQueryParams:function(){return g},AxisTypes:function(){return j},DefaultColorType:function(){return N},DefaultXType:function(){return _},DefaultYType:function(){return C},MarkerTypes:function(){return y},VegaAxisTypes:function(){return b},default:function(){return T}});var l=n(5893),a=n(7294),s=n(5033),i=n(4780),r=n.n(i),o=n(158);let c=e=>(e||"").replace(/"/g,"\\x22").replace(/'/g,"\\x27");function u(e){let{label:t,value:n,setValue:a,columns:s,includeNone:i}=e;return(0,l.jsxs)("label",{children:[t,(0,l.jsx)("div",{className:"select-wrapper",children:(0,l.jsxs)("select",{value:null===n?"":n,onChange:e=>a(""===e.target.value?null:parseInt(e.target.value)),children:[i&&(0,l.jsx)("option",{value:"",children:"-- none --"}),null==s?void 0:s.map((e,t)=>(0,l.jsx)("option",{value:t,children:s[t]},e))]})})]})}function m(e){let{label:t,column:n,setColumn:a,type:s,setType:i,columns:r,includeNone:o}=e;return(0,l.jsxs)("div",{className:"filter-row",style:{display:"flex"},children:[(0,l.jsx)(u,{label:t,value:n,setValue:a,columns:r,includeNone:o}),(0,l.jsxs)("label",{children:["Type",(0,l.jsx)("div",{className:"select-wrapper",children:(0,l.jsx)("select",{value:s,onChange:e=>i(e.target.value),children:j.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})})]})]})}function d(e){let{jsonUrl:t,markerType:n,setMarkerType:s,xColumn:i,setXColumn:r,xType:d,setXType:p,yColumn:h,setYColumn:v,yType:x,setYType:f,colorColumn:j,setColorColumn:g,colorType:_,setColorType:C,sizeColumn:N,setSizeColumn:T,containerClass:D,wrapperClass:w,visDivClass:k}=e,[S,E]=(0,a.useState)(null),O=(0,a.useRef)(null),F=(0,a.useMemo)(()=>"".concat(t).concat(/\?/.exec(t)?"&":"?","_shape=array"),[t]),L=(0,a.useMemo)(()=>S?S[i]:void 0,[i,S]),B=(0,a.useMemo)(()=>S?S[h]:void 0,[h,S]),H=(0,a.useMemo)(()=>S&&null!==j?S[j]:void 0,[j,S]),I=(0,a.useMemo)(()=>S&&null!==N?S[N]:void 0,[N,S]);(0,a.useEffect)(()=>{let e=localStorage.getItem(F),t=e?Promise.resolve(JSON.parse(e)).then(e=>(console.log("Loaded ".concat(e.length," rows from cache, for ").concat(F)),e)):fetch(F).then(e=>e.json()).then(e=>(console.log("Caching ".concat(e.length," rows from ").concat(F)),localStorage.setItem(F,JSON.stringify(e)),e));t.then(e=>{if(e.length>1){console.log("got rows:",e);let t=Object.keys(e[0]).map(t=>e.filter(e=>{var n;return(null===(n=e[t])||void 0===n?void 0:n.label)!==void 0}).length?"".concat(t,".label"):t);E(t)}})},[F,E]),(0,a.useEffect)(()=>{let e=O.current;if(!e||!L||!B)return;let t=b[d],l=b[x],a=!!/, binned$/.exec(d),s=!!/, binned$/.exec(x),i="Bar"==n?"bar":"Line"==n?"line":"circle",r={x:{field:L,type:t,bin:a},y:{field:B,type:l,bin:s}};function u(e){let t=c(e);return"".concat(t,": ' + datum['").concat(t,"']")}H&&(r.color={field:H,type:b[_]}),I&&(r.size={field:I,type:"quantitative"});let m=[u(L),u(B)];H&&m.push(u(H)),I&&m.push(u(I));let p="'"+m.join(" + ',<br>");console.log("embed:",F,"xCol",L,"yCol",B,"calculate",p,"encoding",r),(0,o.ZP)(e,{data:{url:F},transform:[{calculate:p,as:"_tooltip_summary"}],mark:{type:i,tooltip:!0},encoding:r,width:"container"},{theme:"quartz",tooltip:!0})},[O.current,F,L,d,B,x,H,_,I,n]);let V=(0,a.useCallback)(e=>{e.preventDefault(),r(h),p(x),v(i),f(d)},[i,d,h,x]);return(null==S?void 0:S.length)&&(null==S?void 0:S.length)>1?(0,l.jsxs)("div",{className:D||"",children:[(0,l.jsxs)("form",{action:"",method:"GET",id:"graphForm",className:"datasette-vega",children:[(0,l.jsx)("h3",{children:"Charting options"}),(0,l.jsx)("div",{className:"filter-row radio-buttons",children:y.map(e=>(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"radio",name:"mark",value:e,checked:e===n,onChange:e=>s(e.target.value)}),e]},e))}),(0,l.jsx)(m,{label:"X Column",column:i,setColumn:e=>r(e||0),type:d,setType:p,columns:S}),(0,l.jsx)(m,{label:"Y Column",column:h,setColumn:e=>v(e||0),type:x,setType:f,columns:S}),(0,l.jsx)("div",{className:"swap-x-y",children:(0,l.jsx)("button",{onClick:V,children:"Swap X and Y"})}),(0,l.jsx)(m,{label:"Color",column:j,setColumn:g,type:_,setType:C,columns:S,includeNone:!0}),(0,l.jsx)("div",{className:"filter-row",children:(0,l.jsx)(u,{label:"Size",value:N,setValue:T,columns:S,includeNone:!0})})]}),(0,l.jsx)("div",{className:w||"",children:(0,l.jsx)("div",{className:k||"",ref:O})})]}):null}var p=n(9008),h=n.n(p),v=n(1664),x=n.n(v),f=n(8048);let y=["Bar","Line","Scatter"],j=["Numeric","Numeric, binned","Date/time","Date/time, binned","Label","Category"],g={Numeric:"n","Numeric, binned":"nb","Date/time":"d","Date/time, binned":"db",Label:"l",Category:"c"},b={Numeric:"quantitative","Numeric, binned":"quantitative","Date/time":"temporal","Date/time, binned":"temporal",Label:"ordinal",Category:"nominal"},_="Numeric",C="Numeric",N="Numeric";function T(){let e={u:(0,s.kU)("https://fivethirtyeight.datasettes.com/fivethirtyeight/nba-elo~2Fnbaallelo.json"),m:(0,s.gO)("Bar",{Bar:"b",Line:"l",Scatter:"s"}),x:(0,s.Gr)(0),xt:(0,s.gO)(_,g),y:(0,s.Gr)(0),yt:(0,s.gO)(C,g),c:(0,s.dB)(),ct:(0,s.gO)(C,g),s:(0,s.dB)()},{u:[t,n],m:[i,o],x:[c,u],xt:[m,p],y:[v,y],yt:[j,b],c:[T,D],ct:[w,k],s:[S,E]}=(0,s.O5)({params:e}),O=(0,a.useCallback)(e=>{e.preventDefault();let t=e.currentTarget.elements.namedItem("url"),l=t.value;n(l),u(0),p(_),y(0),b(C),D(null),k(N),E(null)},[]),F=(0,f.b)();return(0,l.jsxs)("div",{className:r().container,children:[(0,l.jsxs)(h(),{children:[(0,l.jsx)("title",{children:"Datasette-Vega"}),(0,l.jsx)("meta",{name:"description",content:"Demo of Datasette-Vega React component"}),(0,l.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,l.jsxs)("main",{className:r().main,children:[(0,l.jsx)("h1",{className:r().title,children:"Datasette Vega"}),(0,l.jsx)("p",{children:"Enter the URL of the JSON version of any Datasette table:"}),(0,l.jsxs)("form",{className:r().jsonUrlForm,onSubmit:O,method:"GET",children:[(0,l.jsx)("input",{id:"jsonUrl",className:r().urlInput,type:"text",name:"url",defaultValue:t}),(0,l.jsx)("input",{type:"submit",value:"Load",style:{fontSize:"1.2em",border:"1px solid #ccc"}}),(0,l.jsxs)("p",{children:["Examples:"," ",(0,l.jsx)(x(),{href:"".concat(F).concat("/?m=b&x=2&xt=c&y=11&c=9&ct=c"),children:"game_id/pts/team_id"}),","," ",(0,l.jsx)(x(),{href:"".concat(F).concat("/?m=s&x=17&y=11&c=21&ct=c&s=11"),children:"pts/opp_pts/result"}),","," ",(0,l.jsx)(x(),{href:"".concat(F).concat("/?u=fivethirtyeight.datasettes.com%2Ffivethirtyeight%2Fbad-drivers~2Fbad-drivers.json&m=s&x=3&y=4&c=1&ct=c&s=2"),children:"fatalities_per_billion_miles/speeding/alcohol/state"}),","]})]}),(0,l.jsx)(d,{containerClass:r().visContainer,wrapperClass:r().visWrapper,visDivClass:r().visDiv,jsonUrl:t,markerType:i,setMarkerType:o,xColumn:c,setXColumn:u,xType:m,setXType:p,yColumn:v,setYColumn:y,yType:j,setYType:b,colorColumn:T,setColorColumn:D,colorType:w,setColorType:k,sizeColumn:S,setSizeColumn:E})]})]})}},4780:function(e){e.exports={container:"Home_container__B1VFq","datasette-vega-demo":"Home_datasette-vega-demo__gChvG",jsonUrlForm:"Home_jsonUrlForm__5cCWj",urlInput:"Home_urlInput__tTpJK",visContainer:"Home_visContainer__guBIo",visWrapper:"Home_visWrapper__jie46",visDiv:"Home_visDiv__4_Zvm",main:"Home_main__3vDCl"}}},function(e){e.O(0,[662,403,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);