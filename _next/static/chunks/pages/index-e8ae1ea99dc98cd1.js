(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(6854)}])},6854:function(e,t,n){"use strict";n.r(t),n.d(t,{AxisTypeQueryParams:function(){return b},AxisTypes:function(){return y},DefaultColorType:function(){return T},DefaultXType:function(){return N},DefaultYType:function(){return D},MarkerTypes:function(){return j},VegaAxisTypes:function(){return C},default:function(){return w}});var a=n(5893),l=n(7294),s=n(5033),i=n(4780),r=n.n(i),o=n(158),c=n(8669),u=n.n(c),d=n(9612);function m(e){let{label:t,value:n,setValue:l,columns:s,includeNone:i}=e;return(0,a.jsxs)("label",{children:[t," ",(0,a.jsx)("div",{className:"select-wrapper",children:(0,a.jsxs)("select",{value:null===n?"":n,onChange:e=>l(""===e.target.value?null:parseInt(e.target.value)),children:[i&&(0,a.jsx)("option",{value:"",children:"-- none --"}),null==s?void 0:s.map((e,t)=>(0,a.jsx)("option",{value:t,children:s[t]},e))]})})]})}function h(e){let{label:t,column:n,setColumn:l,type:s,setType:i,columns:r,includeNone:o}=e;return(0,a.jsxs)("div",{className:"filter-row",style:{display:"flex"},children:[(0,a.jsx)(m,{label:t,value:n,setValue:l,columns:r,includeNone:o}),(0,a.jsxs)("label",{children:["Type"," ",(0,a.jsx)("div",{className:"select-wrapper",children:(0,a.jsx)("select",{value:s,onChange:e=>i(e.target.value),children:y.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})})]})]})}function p(e){var t,n;let{jsonUrl:s,markerType:i,setMarkerType:r,xColumn:c,setXColumn:p,xType:v,setXType:f,yColumn:g,setYColumn:x,yType:_,setYType:y,colorColumn:b,setColorColumn:N,colorType:D,setColorType:T,sizeColumn:w,setSizeColumn:V,containerClass:E,wrapperClass:k,visDivClass:B}=e,[S,O]=(0,l.useState)(null),H=(0,d.NB)(),L=(0,l.useRef)(null),X=(0,l.useMemo)(()=>"".concat(s).concat(/\?/.exec(s)?"&":"?","_shape=array"),[s]),F=(0,l.useMemo)(()=>S?S[c]:void 0,[c,S]),Y=(0,l.useMemo)(()=>S?S[g]:void 0,[g,S]),I=(0,l.useMemo)(()=>S&&null!==b?S[b]:void 0,[b,S]),z=(0,l.useMemo)(()=>S&&null!==w?S[w]:void 0,[w,S]);(0,l.useEffect)(()=>{let e=localStorage.getItem(X),t=e?Promise.resolve(JSON.parse(e)).then(e=>(console.log("Loaded ".concat(e.length," rows from cache, for ").concat(X)),e)):fetch(X).then(e=>e.json()).then(e=>(console.log("Caching ".concat(e.length," rows from ").concat(X)),localStorage.setItem(X,JSON.stringify(e)),e));t.then(e=>{if(e.length>1){console.log("got rows:",e);let t=Object.keys(e[0]).map(t=>e.filter(e=>{var n;return(null===(n=e[t])||void 0===n?void 0:n.label)!==void 0}).length?"".concat(t,".label"):t);O(t)}})},[X,O]),(0,l.useEffect)(()=>{var e;let t=L.current;if(!t||!F||!Y)return;let n=C[v],a=C[_],l=!!/, binned$/.exec(v),s=!!/, binned$/.exec(_),r="Bar"==i?"bar":"Line"==i?"line":"circle",c={x:{field:F,type:n,bin:l},y:{field:Y,type:a,bin:s}};I&&(c.color={field:I,type:C[D]}),z&&(c.size={field:z,type:"quantitative"}),console.log("embed:",X,"xCol",F,"yCol",Y,"encoding",c,"wrapper",H.ref.current,"height",H.height,null===(e=H.ref.current)||void 0===e?void 0:e.offsetHeight,"ref",t,"height",null==t?void 0:t.offsetHeight),(0,o.ZP)(t,{data:{url:X},mark:{type:r,tooltip:{content:"data"}},encoding:c,height:"container",width:"container",autosize:{type:"fit"}},{theme:"quartz",tooltip:!0})},[L.current,null===(t=L.current)||void 0===t?void 0:t.offsetWidth,null===(n=L.current)||void 0===n?void 0:n.offsetHeight,X,F,v,Y,_,I,D,z,i,H.width,H.height,H.ref.current]);let M=(0,l.useCallback)(e=>{e.preventDefault(),p(g),f(_),x(c),y(v)},[c,v,g,_]);return(null==S?void 0:S.length)&&(null==S?void 0:S.length)>1?(0,a.jsxs)("div",{className:E||"",children:[(0,a.jsxs)("form",{action:"",method:"GET",id:"graphForm",className:u().datasetteVega,children:[(0,a.jsx)("h3",{children:"Charting options"}),(0,a.jsx)("div",{className:"filter-row ".concat(u().radioButtons),children:j.map(e=>(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"radio",name:"mark",value:e,checked:e===i,onChange:e=>r(e.target.value)}),e]},e))}),(0,a.jsx)(h,{label:"X Column",column:c,setColumn:e=>p(e||0),type:v,setType:f,columns:S}),(0,a.jsx)(h,{label:"Y Column",column:g,setColumn:e=>x(e||0),type:_,setType:y,columns:S}),(0,a.jsx)("div",{className:u().swapXY,children:(0,a.jsx)("button",{onClick:M,children:"Swap X and Y"})}),(0,a.jsx)(h,{label:"Color",column:b,setColumn:N,type:D,setType:T,columns:S,includeNone:!0}),(0,a.jsx)("div",{className:"filter-row",children:(0,a.jsx)(m,{label:"Size",value:w,setValue:V,columns:S,includeNone:!0})})]}),(0,a.jsx)("div",{ref:H.ref,className:k||"",children:(0,a.jsx)("div",{className:"".concat(u().vegaEmbed," ").concat(B),ref:L})})]}):null}var v=n(9008),f=n.n(v),g=n(1664),x=n.n(g),_=n(8048);let j=["Bar","Line","Scatter"],y=["Numeric","Numeric, binned","Date/time","Date/time, binned","Label","Category"],b={Numeric:"n","Numeric, binned":"nb","Date/time":"d","Date/time, binned":"db",Label:"l",Category:"c"},C={Numeric:"quantitative","Numeric, binned":"quantitative","Date/time":"temporal","Date/time, binned":"temporal",Label:"ordinal",Category:"nominal"},N="Numeric",D="Numeric",T="Numeric";function w(){let e={u:(0,s.kU)("https://fivethirtyeight.datasettes.com/fivethirtyeight/nba-elo~2Fnbaallelo.json"),m:(0,s.gO)("Bar",{Bar:"b",Line:"l",Scatter:"s"}),x:(0,s.Gr)(0),xt:(0,s.gO)(N,b),y:(0,s.Gr)(0),yt:(0,s.gO)(D,b),c:(0,s.dB)(),ct:(0,s.gO)(D,b),s:(0,s.dB)()},{u:[t,n],m:[i,o],x:[c,u],xt:[d,m],y:[h,v],yt:[g,j],c:[y,C],ct:[w,V],s:[E,k]}=(0,s.O5)({params:e}),B=(0,l.useCallback)(e=>{e.preventDefault();let t=e.currentTarget.elements.namedItem("url"),a=t.value;n(a),u(0),m(N),v(0),j(D),C(null),V(T),k(null)},[]),S=(0,_.b)();return(0,a.jsxs)("div",{className:r().container,children:[(0,a.jsxs)(f(),{children:[(0,a.jsx)("title",{children:"Datasette-Vega"}),(0,a.jsx)("meta",{name:"description",content:"Demo of Datasette-Vega React component"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsxs)("main",{className:r().main,children:[(0,a.jsx)("h1",{className:r().title,children:"Datasette Vega"}),(0,a.jsx)("p",{children:"Enter the URL of the JSON version of any Datasette table:"}),(0,a.jsxs)("form",{className:r().jsonUrlForm,onSubmit:B,method:"GET",children:[(0,a.jsx)("input",{id:"jsonUrl",className:r().urlInput,type:"text",name:"url",defaultValue:t}),(0,a.jsx)("input",{type:"submit",value:"Load",style:{fontSize:"1.2em",border:"1px solid #ccc"}}),(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{children:"Examples"}),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:(0,a.jsx)(x(),{href:"".concat(S).concat("/?m=b&x=2&xt=c&y=11&c=9&ct=c"),children:"NBA ELO: game_id/pts/team_id"})}),(0,a.jsx)("li",{children:(0,a.jsx)(x(),{href:"".concat(S).concat("/?m=s&x=17&y=11&c=21&ct=c&s=11"),children:"NBA ELO: pts/opp_pts/result"})}),(0,a.jsx)("li",{children:(0,a.jsx)(x(),{href:"".concat(S).concat("/?u=fivethirtyeight.datasettes.com%2Ffivethirtyeight%2Fbad-drivers~2Fbad-drivers.json&m=s&x=3&y=4&c=1&ct=c&s=2"),children:"Crash stats by state"})})]})]})]}),(0,a.jsx)(p,{containerClass:r().visContainer,wrapperClass:r().visWrapper,visDivClass:r().visDiv,jsonUrl:t,markerType:i,setMarkerType:o,xColumn:c,setXColumn:u,xType:d,setXType:m,yColumn:h,setYColumn:v,yType:g,setYType:j,colorColumn:y,setColorColumn:C,colorType:w,setColorType:V,sizeColumn:E,setSizeColumn:k})]})]})}},8669:function(e){e.exports={vegaEmbed:"DatasetteVega_vegaEmbed__sClXC","vega-actions-wrapper":"DatasetteVega_vega-actions-wrapper__YNcE8","vega-actions":"DatasetteVega_vega-actions__DbjfB",datasetteVega:"DatasetteVega_datasetteVega__SgZbJ",swapXY:"DatasetteVega_swapXY__mn0uR","datasette-vega-inactive":"DatasetteVega_datasette-vega-inactive__l0aZP",form:"DatasetteVega_form__vRu90",radioButtons:"DatasetteVega_radioButtons__WfFvP"}},4780:function(e){e.exports={container:"Home_container__B1VFq",main:"Home_main__3vDCl","datasette-vega-demo":"Home_datasette-vega-demo__gChvG",jsonUrlForm:"Home_jsonUrlForm__5cCWj",urlInput:"Home_urlInput__tTpJK",visContainer:"Home_visContainer__guBIo",visWrapper:"Home_visWrapper__jie46",visDiv:"Home_visDiv__4_Zvm"}}},function(e){e.O(0,[662,996,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);